{% load partials %}

{# This page render the project details with steps and the tasks if a step is selected #}

{% partialdef step_item %}
    <div class="card card-compact bg-base-100 shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer border-l-4 p-0
        {% if inventory.id == inventory_id %}active-step{% endif %}"
        hx-get="{% url 'projects:inventory:inventory_detail' project_id=project_id inventory_id=inventory.id %}"
        hx-target="#content-block"
        hx-swap="innerHTML"
        hx-push-url="true"
        {% if oob %} hx-swap-oob="true" {% endif %}
        hx-on::before-request="document.querySelectorAll('#sidebar .card').forEach(el => el.classList.remove('active-step')); this.classList.add('active-step')"
        id="step-card-{{step.id}}">
        <div class="card-body">
            <div class="flex items-start justify-between gap-2">
                <h3 class="font-semibold text-base-content">{{inventory.to_str | safe  }}</h3>
            </div>
            <!-- <p class="text-sm text-base-content/70">{{step.get_progress_text}}</p> -->
        </div>
    </div>
{% endpartialdef %}

{% for inventory in inventories %}
    {% partial step_item %}
{% endfor %}

{% block extra_js %}
<script>
    function togglePassword(btn) {
        const input = btn.parentElement.querySelector("input[data-password-field]");
        if (!input) return;

        if (input.type === "password") {
            input.type = "text";
            btn.innerHTML = '<i data-lucide="eye-closed" style="width:16px;height:16px;"></i>';
        } else {
            input.type = "password";
            btn.innerHTML = '<i data-lucide="eye" style="width:16px;height:16px;"></i>';
        }
        lucide.createIcons();
    }
</script>
{% endblock %}