{% load partials custom_filters %}

{% partialdef title_display %}
    <div class="flex items-center space-x-2" 
        id="title-wrapper-{{ object.id }}">
        
        <h1 class="text-3xl font-bold text-base-content">
            {{ object.title }}
        </h1>

        {% if can_edit %}
            <button hx-get="{% url_with_query edit_endpoint_base 'mode=edit&field=title' %}"
                hx-target="#title-wrapper-{{ object.id }}"
                hx-swap="outerHTML"
                class="text-base-content/50 hover:text-primary transition-colors p-1 rounded">
                <i data-lucide="pencil" style="width:16px;height:16px;"></i>
            </button>
        {% endif %}
    </div>
{% endpartialdef %}

{% partialdef title_form %}
    <form hx-post="{% url_with_query edit_endpoint_base 'mode=save&field=title' %}"
        hx-target="#title-wrapper-{{ object.id }}" 
        hx-swap="outerHTML"
        class="flex items-center space-x-2"
        id="title-wrapper-{{ object.id }}">

        <input type="text" name="title" 
            value="{{ object.title }}"
            class="text-3xl font-bold text-base-content border-b border-primary focus:outline-none bg-transparent w-full"
            autofocus> 

        <button type="submit" class="text-success hover:text-green-700 transition-colors p-1 rounded">
            <i data-lucide="save" style="width:16px;height:16px;"></i>
        </button>
        
        <button type="button" 
                hx-get="{% url_with_query edit_endpoint_base 'mode=display&field=title' %}"
                hx-target="#title-wrapper-{{ object.id }}"
                hx-swap="outerHTML"
                class="transition-colors p-1 rounded">
            <i data-lucide="x" style="width:16px;height:16px;"></i>
        </button>
    </form>
{% endpartialdef %}

{% partialdef description_display %}
<div class="flex items-center space-x-2" id="description-wrapper-{{ object.id }}">
    <p class="text-base-content/70">{{ object.description|default:"Add description..." }}</p>
    {% if can_edit %}
    <button hx-get="{% url_with_query edit_endpoint_base 'mode=edit&field=description' %}"
        hx-target="#description-wrapper-{{ object.id }}"
        hx-swap="outerHTML"
        class="text-base-content/50 hover:text-primary transition-colors p-1 rounded">
        <i data-lucide="pencil" style="width:16px;height:16px;"></i>
    </button>
    {% endif %}
</div>
{% endpartialdef %}

{% partialdef description_form %}
    <form hx-post="{% url_with_query edit_endpoint_base 'mode=save&field=description' %}"
        hx-target="#description-wrapper-{{ object.id }}" 
        hx-swap="outerHTML"
        class="flex items-center space-x-2 w-full"
        id="description-wrapper-{{ object.id }}">

        <textarea name="description" 
              class="text-base-content/70 border-b border-primary focus:outline-none bg-transparent w-full resize-none p-1"
              rows="4"  
              autofocus>{{ object.description }}</textarea>

        <button type="submit" class="text-success hover:text-green-700 transition-colors p-1 rounded">
            <i data-lucide="save" style="width:16px;height:16px;"></i>
        </button>
        
        <button type="button" 
            hx-get="{% url_with_query edit_endpoint_base 'mode=display&field=description' %}"
            hx-target="#description-wrapper-{{ object.id }}"
            hx-swap="outerHTML"
            class="transition-colors p-1 rounded">
            <i data-lucide="x" style="width:16px;height:16px;"></i>
        </button>
    </form>
{% endpartialdef %}

<div class="mb-8">
    <div class="flex items-center space-x-2">
        {% if object.icon %}
            <h1 class="text-3xl font-bold text-base-content">{{ object.icon }}</h1>
        {% endif %}
        {% partial title_display %}
    </div>
    <div class="flex items-center space-x-2 mt-2">
        {% partial description_display %}
    </div>
</div>