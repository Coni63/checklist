
{# This page render the card of a single task on the project detail page #}

<div class="card bg-base-100 shadow-md border-l-4
    {% if task.status == 'done' %}border-success
    {% elif task.status == 'na' %}border-warning
    {% else %}border-error{% endif %}
    hover:shadow-lg transition-all duration-200">
    <div class="card-body p-4">
        <div class="flex items-start gap-4">
            {# Task Number Badge #}
            <div class="badge badge-lg
                {% if task.status == 'done' %}badge-success
                {% elif task.status == 'na' %}badge-warning
                {% else %}badge-primary{% endif %}
                font-bold">
                {{ task.order }}
            </div>

            {# Task Title #}
            <div class="flex-1">
                <h3 class="font-medium text-base-content
                    {% if task.status == 'done' %}line-through text-base-content/50
                    {% elif task.status == 'na' %}italic text-base-content/60{% endif %}">
                    {{task.title}}
                </h3>
            </div>

            {# Action Buttons #}
            <div class="flex gap-2 items-center flex-wrap">
                {% if task.info %}
                    <a href="{{ task.info }}" target="_blank" class="btn btn-sm btn-info btn-outline" title="More info">
                        â„¹ Info
                    </a>
                {% endif %}

                {% if task.status == 'done' %}
                    <button
                        hx-post="{% url 'projects:set_status' project_id=task.project_step.project.id step_id=task.project_step.id task_id=task.id %}"
                        hx-vals='{"status": "undone"}'
                        hx-target="closest .card"
                        hx-swap="outerHTML"
                        class="btn btn-sm btn-success">
                        âœ“ Done
                    </button>
                {% else %}
                    <button
                        hx-post="{% url 'projects:set_status' project_id=task.project_step.project.id step_id=task.project_step.id task_id=task.id %}"
                        hx-vals='{"status": "done"}'
                        hx-target="closest .card"
                        hx-swap="outerHTML"
                        class="btn btn-sm btn-primary">
                        Done
                    </button>
                {% endif %}

                {% if task.status == 'na' %}
                    <button
                        hx-post="{% url 'projects:set_status' project_id=task.project_step.project.id step_id=task.project_step.id task_id=task.id %}"
                        hx-vals='{"status": "unna"}'
                        hx-target="closest .card"
                        hx-swap="outerHTML"
                        class="btn btn-sm btn-warning">
                        â—‹ N/A
                    </button>
                {% else %}
                    <button
                        hx-post="{% url 'projects:set_status' project_id=task.project_step.project.id step_id=task.project_step.id task_id=task.id %}"
                        hx-vals='{"status": "na"}'
                        hx-target="closest .card"
                        hx-swap="outerHTML"
                        class="btn btn-sm btn-outline">
                        N/A
                    </button>
                {% endif %}
            </div>
        </div>

        {# Comments Section #}
        <div class="mt-3 border-t border-base-300 pt-3">
            <button class="btn btn-ghost btn-sm gap-2"
                hx-get="{% url 'projects:task_comment_list' task.id %}"
                hx-target="#comment-area-{{ task.id }}"
                hx-swap="innerHTML"
                hx-trigger="click once"
                onclick="toggleComment('{{ task.id }}')">
                ðŸ’¬ Comments
            </button>

            <div id="comment-area-{{ task.id }}" class="hidden mt-3">
                {# Comments will be loaded here #}
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    function toggleComment(taskId) {
        const el = document.getElementById("comment-area-" + taskId);
        el.classList.toggle("hidden");
    }
</script>
{% endblock %}
